<%inherit file="default.mhtml" />
<%! from wmk import MDContentList %>

<%block name="page_title">${ page.title }${ ' - page %d' % context.get('_page') if context.get('_page') else '' }</%block>

<%block name="content">
  <%
    chunks = None
    cnf = page.TAXONOMY.list_settings
    paginate = cnf.pagination or False
    pagesize = cnf.per_page or 5
    curpage = 1
    if paginate:
        wrapped = MDContentList(TAXONS)
        chunks, page_urls = wrapped.paginate(pagesize, context)
        curpage = context.get('_page', 1)
  %>
  % if curpage == 1:
    ${ CONTENT }
  % endif

  % if chunks:

    <ul>
    % for it in chunks[curpage-1]:
      <li><a href="${ it['url'] }">${ it['name'] }</a></li>
    % endfor
    </ul>
    % if len(chunks) > 1:
      ${ _prevnext(len(chunks), curpage, page_urls) }
    % endif

  % else:

    <ul>
    % for it in TAXONS:
      <li><a href="${ it['url'] }">${ it['name'] }</a> (${ it['count'] })</li>
    % endfor
    </ul>

  % endif

</%block>

<%def name="_prevnext(pages, curpage, urls)">
  <p>Pages: [
  % for i in range(pages):
    % if curpage == i+1:
      <strong>${ curpage }</strong>
    % else:
      <a href="${ urls[i] }">${ (i+1) }</a>
    % endif
  % endfor
  ]
  </p>
</%def>
